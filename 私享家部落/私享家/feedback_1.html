<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title></title>
    <link rel="stylesheet" href="css/font.css" />
    <link rel="stylesheet" href="css/style.css" />
    <style type="text/css">
    	#files{z-index: 2;}
    	img[src=""],img:not([src]){opacity:0;}
    	#xmImg_1{width: 100%;height: 100%;z-index: 1;}
    </style>
</head>
<body>
	<h1 class="h1">
		<button class="iconfont icon-xiangzuo1" onclick="javascript:history.back(-1);"></button>
    	<p data-lang="shoukuanxinxi">收集市场意见</p>
	</h1>
	<div class="mt"></div>
	<h2 style="padding: 10px 0 0 10px;">【人工线下回复】</h2>
	<div class="feedback">
		<div class="feedb_list">
			<h2>反馈标题</h2>
			<div class="feedback_contert">
				<input id="text" type="text" placeholder="请输入反馈标题"  maxlength="30" onkeyup="checknum()" />
				<span id="in" type="text" disabled="disabled"></span>
			</div>
		</div>
		<div class="mt"></div>
		<div class="feedb_list">
			<h2>反馈内容<span id="ins">0/200</span></h2>
			<div class="feedback_contert">
				<textarea id="texts" placeholder="请输入反馈详细内容" type="text"  maxlength="200" onkeyup="checknums()" /></textarea>
			</div>
		</div>
		<div class="mt"></div>
		<div class="feedb_list images">
			<h2>上传图片</h2>
			<div class="release_up_pic">		
				<div class="up_pic">
					<span id="chose_pic_btn" style="">
						<input type="file" name="file1" id="files" accept="image/*" onchange="xmTanUploadImg_1(this)" />
						<img src="" id="xmImg_1" accept="image/*"/>
					</span>	
				</div>
			</div>
		</div>
		<button class="annius" onclick="login()">提交</button>
	</div>
	
	

<script type="text/javascript" src="js/jquery-3.4.1.min.js" ></script>
<script src="layer/layer.js" type="text/javascript" charset="utf-8"></script>
<script>
	//图片预览
   function xmTanUploadImg_1(obj) {
        var file = obj.files[0];
		console.log(obj);console.log(file);
		console.log("file.size = " + file.size); //file.size 单位为byte
		var reader = new FileReader();
		reader.onload = function (e) {
		console.log("成功读取....");
		var size = file.size/1024;
		var size = size/1024;
		if (size>4) {
			layer.msg('上传图片不能超过4MB，请重新选择！', { icon: 2,time: 2000});
			return false;
		}
		var img = document.getElementById("xmImg_1");
		img.src = e.target.result;
		//或者 img.src = this.result; //e.target == this
		}
		reader.readAsDataURL(file)
	}
   function checknum(){
        var nMax = 30;
        var textDom =  document.getElementById("text");
        var len =textDom.value.length;    
        if(len>nMax){
            textDom.value = textDom.value.substring(0,nMax);
            nMax = 0;
        }
        document.getElementById("in").innerText=(nMax-len)+"/30";
    }
    
    function checknums(){
        var nMaxs = 200;
        var textDoms =  document.getElementById("texts");
        var lens =textDoms.value.length;
        if(lens>nMaxs){
            textDoms.value = textDoms.value.substring(0,nMaxs);
            nMaxs = 0;
        }
        document.getElementById("ins").innerText=(nMaxs-lens)+"/200";
    }
     
    checknum();
    function login(){
    	var title = $("#text").val();
    	var content = $("#texts").val();
    	if(title == ""){
    		layer.msg('请输入标题');
    		return ;
    	}
    	if(content == ""){
    		layer.msg('请输入内容');
    		return ;
    	}
    	var form = new FormData();
    	for (var i = 0; i < files.length; i++) {
    		form.append('files',files[i]);
		}
    	form.append('files',files);
    	form.append('title',title);
    	form.append('content',content);
    	console.log(files)
		$.ajax({
			url:'addFeeback',
            type: 'POST',
            data: form,
            dataType: 'JSON',
            cache: false,
            processData: false,
            contentType: false,
			success:function(res){
				layer.alert("提交成功",function(){window.location.href = "/toUser";});
				//layer.msg('提交成功');
				/* layer.open({
					title: ['提示'],
					content: '提交成功',
					btn: ['确定'],
					shadeClose: true,
					//回调函数
					yes: function(index, layero){
						window.location.href = "/toUser";
					}
			});   */
            	//window.location.href = "/toUser";
            }
		})
    }
</script>
</body>
</html>